{# ===================================================================== #}
{#  Detalle del producto - Accesibilidad WCAG 2.1 AA                    #}
{# ===================================================================== #}
{% extends 'base.html.twig' %}

{% block title %}{{ producto.nombre }} - Economik0{% endblock %}

{% block body %}
<article class="container py-5" aria-labelledby="producto-heading">
    {# ========== MENSAJES FLASH ACCESIBLES ========== #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label }} alert-dismissible fade show" 
                 role="alert" 
                 aria-live="polite">
                <span>{{ message }}</span>
                <button type="button" 
                        class="btn-close" 
                        data-bs-dismiss="alert" 
                        aria-label="Cerrar mensaje de alerta"></button>
            </div>
        {% endfor %}
    {% endfor %}

    {# ========== NAVEGACI√ìN (Breadcrumb) ========== #}
    <nav aria-label="Ruta de navegaci√≥n" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{{ path('app_tienda') }}">Tienda</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                {{ producto.nombre }}
            </li>
        </ol>
    </nav>

    {# ========== CONTENIDO PRINCIPAL ========== #}
    <div class="row g-5">
        {# ----- Imagen del producto ----- #}
        <div class="col-lg-6">
            <figure class="product-detail-figure">
                {% if producto.imagen %}
                    <img src="{{ asset('uploads/productos/' ~ producto.imagen) }}" 
                         class="img-fluid rounded shadow product-detail-img" 
                         alt="Imagen detallada de {{ producto.nombre }}"
                         width="600"
                         height="400">
                {% else %}
                    <div class="product-detail-placeholder d-flex align-items-center justify-content-center bg-light rounded shadow" 
                         role="img" 
                         aria-label="Sin imagen disponible para {{ producto.nombre }}"
                         style="min-height: 400px;">
                        <span aria-hidden="true" class="display-1 text-muted">üì¶</span>
                    </div>
                {% endif %}
                <figcaption class="visually-hidden">
                    Imagen del producto {{ producto.nombre }}
                </figcaption>
            </figure>
        </div>

        {# ----- Informaci√≥n del producto ----- #}
        <div class="col-lg-6">
            <header>
                <h1 id="producto-heading" class="display-5 fw-bold mb-3">
                    {{ producto.nombre }}
                </h1>
                <p class="badge bg-secondary fs-6 mb-3">
                    <span class="visually-hidden">Categor√≠a:</span>
                    {{ producto.categoria }}
                </p>
            </header>

            <section aria-labelledby="descripcion-heading">
                <h2 id="descripcion-heading" class="visually-hidden">Descripci√≥n</h2>
                <p class="lead text-muted mb-4">{{ producto.descripcion }}</p>
            </section>

            {# Informaci√≥n de stock #}
            <section aria-labelledby="disponibilidad-heading" class="mb-4">
                <h2 id="disponibilidad-heading" class="visually-hidden">Disponibilidad</h2>
                {% if producto.cantidad > 0 %}
                    <p class="text-success fw-semibold" role="status">
                        <span aria-hidden="true">‚úÖ</span>
                        En stock: {{ producto.cantidad }} unidades disponibles
                    </p>
                {% else %}
                    <p class="text-danger fw-semibold" role="status">
                        <span aria-hidden="true">‚ùå</span>
                        Sin stock disponible
                    </p>
                {% endif %}
            </section>

            {# Precio destacado #}
            <section aria-labelledby="precio-heading" class="mb-4">
                <h2 id="precio-heading" class="visually-hidden">Precio</h2>
                <p class="display-4 fw-bold text-primary">
                    {{ producto.precio|number_format(2, ',', '.') }} ‚Ç¨
                </p>
            </section>

            {# ========== FORMULARIO A√ëADIR AL CARRITO ========== #}
            {% if producto.cantidad > 0 %}
                <section aria-labelledby="carrito-heading">
                    <h2 id="carrito-heading" class="visually-hidden">A√±adir al carrito</h2>
                    <form action="{{ path('app_cart_add', {id: producto.id}) }}" 
                          method="post"
                          class="d-flex gap-3 align-items-end flex-wrap"
                          aria-label="Formulario para a√±adir {{ producto.nombre }} al carrito">
                        
                        <div class="flex-grow-1" style="max-width: 150px;">
                            <label for="cantidad-input" class="form-label fw-semibold">
                                Cantidad
                            </label>
                            <input type="number" 
                                   id="cantidad-input"
                                   name="cantidad" 
                                   class="form-control form-control-lg" 
                                   value="1" 
                                   min="1" 
                                   max="{{ producto.cantidad }}"
                                   aria-describedby="cantidad-help"
                                   required
                                   aria-required="true">
                            <small id="cantidad-help" class="form-text text-muted">
                                M√°ximo: {{ producto.cantidad }}
                            </small>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg flex-grow-1">
                            <span aria-hidden="true">üõí</span>
                            A√±adir al Carrito
                        </button>
                    </form>
                </section>
            {% else %}
                <div class="alert alert-warning" role="alert">
                    <span aria-hidden="true">‚ö†Ô∏è</span>
                    Este producto no est√° disponible actualmente.
                </div>
            {% endif %}

            {# Enlace para volver #}
            <nav aria-label="Navegaci√≥n secundaria" class="mt-5">
                <a href="{{ path('app_tienda') }}" class="btn btn-outline-secondary">
                    <span aria-hidden="true">‚Üê</span>
                    Volver a la tienda
                </a>
            </nav>
        </div>
    </div>
</article>
{% endblock %}
